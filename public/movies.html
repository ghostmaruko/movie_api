<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Movie List</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/style.css" />
  </head>
  <body>
    <h1>Movie Gallery</h1>
    <div class="movie-grid" id="movieGrid"></div>

    <!-- Popup -->
    <div class="popup" id="popup">
      <span class="close-btn" id="closePopup">&times;</span>
      <div class="popup-content">
        <img
          id="popupImg"
          src="/img/placeholder.png"
          alt="Movie Image"
          onerror="this.src='/img/placeholder.png'"
        />
        <div class="popup-description">
          <h2 id="popupTitle"></h2>
          <p id="popupDesc"></p>
          <p><strong>Genre:</strong> <span id="popupGenre"></span></p>
          <p><strong>Director:</strong> <span id="popupDirector"></span></p>
          <p><strong>Year:</strong> <span id="popupYear"></span></p>
          <p><strong>Actors:</strong> <span id="popupActor"></span></p>
        </div>
      </div>
    </div>

    <script>
      // Fetch movies senza token
      fetch("/movies")
        .then(res => {
          if (!res.ok) throw new Error("Errore nel fetch dei film");
          return res.json();
        })
        .then(movies => {
          const grid = document.getElementById("movieGrid");
          movies.forEach(movie => {
            const card = document.createElement("div");
            card.classList.add("movie-card");
            card.innerHTML = `
              <img src="${movie.ImagePath}" alt="${movie.Title}" 
                   onerror="this.src='/img/placeholder.png'">
              <h3>${movie.Title}</h3>
            `;
            card.addEventListener("click", () => openPopup(movie));
            grid.appendChild(card);
          });
        })
        .catch(err => console.error(err));

      // Popup
      const popup = document.getElementById("popup");
      const popupImg = document.getElementById("popupImg");
      const popupTitle = document.getElementById("popupTitle");
      const popupDesc = document.getElementById("popupDesc");
      const popupGenre = document.getElementById("popupGenre");
      const popupDirector = document.getElementById("popupDirector");
      const popupYear = document.getElementById("popupYear");
      const popupActor = document.getElementById("popupActor");
      const closePopup = document.getElementById("closePopup");

      function openPopup(movie) {
        popupImg.src = movie.ImagePath;
        popupImg.onerror = () => {
          popupImg.src = '/img/placeholder.png';
        };
        popupTitle.textContent = movie.Title;
        popupDesc.textContent = movie.Description;
        popupGenre.textContent = movie.Genre?.Name || "N/A";
        popupDirector.textContent = movie.Director?.Name || "N/A";
        popupYear.textContent = movie.Year || "N/A";
        popupActor.textContent = movie.Actors?.join(", ") || "N/A";
        popup.style.display = "flex";
      }

      closePopup.addEventListener("click", () => {
        popup.style.display = "none";
      });

      popup.addEventListener("click", e => {
        if (e.target === popup) popup.style.display = "none";
      });
    </script>
  </body>
</html>
