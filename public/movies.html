<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Movie List</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <h1>Movie List</h1>
    <div id="movies-container" class="movie-grid"></div>

    <div id="popup" class="popup">
      <div class="popup-content">
        <img id="popupImg" src="" alt="Movie Poster" />
        <div class="popup-description">
          <span class="close-btn" id="closePopup">&times;</span>
          <h2 id="popupTitle"></h2>
          <p id="popupDescription"></p>
          <p><strong>Genre:</strong> <span id="popupGenre"></span></p>
          <p><strong>Director:</strong> <span id="popupDirector"></span></p>
          <p><strong>Year:</strong> <span id="popupYear"></span></p>
          <p><strong>Actors:</strong> <span id="popupActors"></span></p>
        </div>
      </div>
    </div>

    <script>
      const container = document.getElementById("movies-container");
      const popup = document.getElementById("popup");
      const popupImg = document.getElementById("popupImg");
      const popupTitle = document.getElementById("popupTitle");
      const popupDescription = document.getElementById("popupDescription");
      const popupGenre = document.getElementById("popupGenre");
      const popupDirector = document.getElementById("popupDirector");
      const popupYear = document.getElementById("popupYear");
      const popupActors = document.getElementById("popupActors");
      const closePopup = document.getElementById("closePopup");

      fetch("/movies")
        .then((res) => res.json())
        .then((movies) => {
          movies.forEach((movie) => {
            console.log(movie);

            const card = document.createElement("div");
            card.className = "movie-card";

            const img = document.createElement("img");
            img.src = "/img/" + (movie.imageURL || "placeholder.jpg");
            img.alt = movie.Title;
            img.addEventListener("click", () => showPopup(movie));

            const title = document.createElement("h3");
            title.textContent = movie.Title;

            card.appendChild(img);
            card.appendChild(title);
            container.appendChild(card);
          });
        })
        .catch((err) => console.error(err));

      function showPopup(movie) {
        popupTitle.textContent = movie.title || "N/A";
        popupDescription.textContent = movie.description || "N/A";
        popupGenre.textContent = movie.genre?.name || "N/A";
        popupDirector.textContent = movie.director?.name || "N/A";
        popupYear.textContent = movie.year || "N/A";
        popupActors.textContent = movie.actors?.join(", ") || "N/A";

        popup.style.display = "block";
        overlay.style.display = "block";
      }

      closePopup.addEventListener("click", () => {
        popup.style.display = "none";
      });

      popup.addEventListener("click", (e) => {
        if (e.target === popup) popup.style.display = "none";
      });
    </script>
  </body>
</html>
