<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Movie List</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <h1>Movie List</h1>
    <div class="movie-grid" id="movies-container"></div>

    <!-- POPUP -->
    <div class="popup" id="popup">
      <div class="popup-content">
        <img id="popupImage" src="" alt="" />
        <div class="popup-description">
          <span class="close-btn" id="closePopup">&times;</span>
          <h2 id="popupTitle"></h2>
          <p id="popupDescription"></p>
          <p><strong>Genre:</strong> <span id="popupGenre"></span></p>
          <p><strong>Director:</strong> <span id="popupDirector"></span></p>
          <p><strong>Year:</strong> <span id="popupYear"></span></p>
          <p><strong>Actors:</strong> <span id="popupActors"></span></p>
        </div>
      </div>
    </div>

    <script>
      const container = document.getElementById("movies-container");
      const popup = document.getElementById("popup");

      const popupImage = document.getElementById("popupImage");
      const popupTitle = document.getElementById("popupTitle");
      const popupDescription = document.getElementById("popupDescription");
      const popupGenre = document.getElementById("popupGenre");
      const popupDirector = document.getElementById("popupDirector");
      const popupYear = document.getElementById("popupYear");
      const popupActors = document.getElementById("popupActors");
      const closePopup = document.getElementById("closePopup");

      fetch("/movies")
        .then((res) => res.json())
        .then((movies) => {
          movies.forEach((movie) => {
            const card = document.createElement("div");
            card.className = "movie-card";

            const img = document.createElement("img");
            img.src = "/img/" + (movie.imageURL || "placeholder.jpg");
            img.alt = movie.title || "Movie poster";
            img.addEventListener("click", () => showPopup(movie));

            const title = document.createElement("h3");
            title.textContent = movie.title || "N/A";

            card.appendChild(img);
            card.appendChild(title);
            container.appendChild(card);
          });
        })
        .catch((err) => console.error(err));

      function showPopup(movie) {
        popupImage.src = "/img/" + (movie.imageURL || "placeholder.jpg");
        popupImage.alt = movie.title || "Movie poster";

        popupTitle.textContent = movie.title || "N/A";
        popupDescription.textContent = movie.description || "N/A";
        popupGenre.textContent = movie.genre?.name || "N/A";
        popupDirector.textContent = movie.director?.name || "N/A";
        popupYear.textContent = movie.Year || movie.year || "N/A";
        popupActors.textContent =
          (movie.Actors || movie.actors || []).join(", ") || "N/A";

        popup.style.display = "flex";
      }

      closePopup.addEventListener("click", () => {
        popup.style.display = "none";
      });

      window.addEventListener("click", (e) => {
        if (e.target === popup) {
          popup.style.display = "none";
        }
      });
    </script>
  </body>
</html>
